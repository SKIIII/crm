var $=Object.defineProperty,A=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var P=(o,e,i)=>e in o?$(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i,w=(o,e)=>{for(var i in e||(e={}))L.call(e,i)&&P(o,i,e[i]);if(V)for(var i of V(e))R.call(e,i)&&P(o,i,e[i]);return o},U=(o,e)=>A(o,B(e));import{_ as z,u as D,b as E,c as G,h as y}from"./index.8857c13e.js";import{a2 as x,$ as j,a3 as H,u as M,r as O,b as I,o as W,a4 as T,t as J,d as u,e as F,f as b,j as t,w as n,_ as f,g as K,k as N,i as Q}from"./vendor.bcf7419b.js";import{W as X}from"./wangEditor.71934d25.js";const Y={name:"AddGood",setup(){const{proxy:o}=x();console.log("proxy",o);const e=j(null),i=j(null),c=H(),S=M(),{id:p}=c.query,d=O({uploadImgServer:D,token:E("token")||"",id:p,defaultCate:"",goodForm:{goodsName:"",goodsIntro:"",originalPrice:"",sellingPrice:"",stockNum:"",goodsSellStatus:"0",goodsCoverImg:"",tag:""},rules:{goodsCoverImg:[{required:"true",message:"\u8BF7\u4E0A\u4F20\u4E3B\u56FE",trigger:["change"]}],goodsName:[{required:"true",message:"\u8BF7\u586B\u5199\u5546\u54C1\u540D\u79F0",trigger:["change"]}],originalPrice:[{required:"true",message:"\u8BF7\u586B\u5199\u5546\u54C1\u4EF7\u683C",trigger:["change"]}],sellingPrice:[{required:"true",message:"\u8BF7\u586B\u5199\u5546\u54C1\u552E\u4EF7",trigger:["change"]}],stockNum:[{required:"true",message:"\u8BF7\u586B\u5199\u5546\u54C1\u5E93\u5B58",trigger:["change"]}]},categoryId:"",category:{lazy:!0,lazyLoad(g,a){const{level:r=0,value:s}=g;I.get("/categories",{params:{pageNumber:1,pageSize:1e3,categoryLevel:r+1,parentId:s||0}}).then(C=>{const q=C.list.map(k=>({value:k.categoryId,label:k.categoryName,leaf:r>1}));a(q)})}}});let l;W(()=>{l=new X(e.value),l.config.showLinkImg=!1,l.config.showLinkImgAlt=!1,l.config.showLinkImgHref=!1,l.config.uploadImgMaxSize=2*1024*1024,l.config.uploadFileName="file",l.config.uploadImgHeaders={token:d.token},l.config.uploadImgHooks={customInsert:function(g,a){console.log("result",a),a.data&&a.data.length&&a.data.forEach(r=>g(r))}},l.config.uploadImgServer=G,Object.assign(l.config,{onchange(){console.log("change")}}),l.create(),p&&I.get(`/goods/${p}`).then(g=>{const{goods:a,firstCategory:r,secondCategory:s,thirdCategory:C}=g;d.goodForm={goodsName:a.goodsName,goodsIntro:a.goodsIntro,originalPrice:a.originalPrice,sellingPrice:a.sellingPrice,stockNum:a.stockNum,goodsSellStatus:String(a.goodsSellStatus),goodsCoverImg:o.$filters.prefix(a.goodsCoverImg),tag:a.tag,categoryId:a.goodsCategoryId},d.categoryId=a.goodsCategoryId,d.defaultCate=`${r.categoryName}/${s.categoryName}/${C.categoryName}`,l&&l.txt.html(a.goodsDetailContent)})}),T(()=>{l.destroy(),l=null});const m=()=>{i.value.validate(g=>{if(g){let a=I.post,r={goodsCategoryId:d.categoryId,goodsCoverImg:d.goodForm.goodsCoverImg,goodsDetailContent:l.txt.html(),goodsIntro:d.goodForm.goodsIntro,goodsName:d.goodForm.goodsName,goodsSellStatus:d.goodForm.goodsSellStatus,originalPrice:d.goodForm.originalPrice,sellingPrice:d.goodForm.sellingPrice,stockNum:d.goodForm.stockNum,tag:d.goodForm.tag};if(y(r.goodsIntro)||y(r.goodsName)||y(r.tag)||y(r.goodsDetailContent)){f.error("\u4E0D\u8981\u8F93\u5165\u8868\u60C5\u5305\uFF0C\u518D\u8F93\u5165\u5C31\u6253\u6B7B\u4F60\u4E2A\u9F9F\u5B59\u513F~");return}if(r.goodsName.length>128){f.error("\u5546\u54C1\u540D\u79F0\u4E0D\u80FD\u8D85\u8FC7128\u4E2A\u5B57\u7B26");return}if(r.goodsIntro.length>200){f.error("\u5546\u54C1\u7B80\u4ECB\u4E0D\u80FD\u8D85\u8FC7200\u4E2A\u5B57\u7B26");return}if(r.tag.length>16){f.error("\u5546\u54C1\u6807\u7B7E\u4E0D\u80FD\u8D85\u8FC716\u4E2A\u5B57\u7B26");return}console.log("params",r),p&&(r.goodsId=p,a=I.put),a("/goods",r).then(()=>{f.success(p?"\u4FEE\u6539\u6210\u529F":"\u6DFB\u52A0\u6210\u529F"),S.push({path:"/good"})})}})},h=g=>{const a=g.name.split(".")[1]||"";if(!["jpg","jpeg","png"].includes(a))return f.error("\u8BF7\u4E0A\u4F20 jpg\u3001jpeg\u3001png \u683C\u5F0F\u7684\u56FE\u7247"),!1},_=g=>{d.goodForm.goodsCoverImg=g.data||""},v=g=>{d.categoryId=g[2]||0};return U(w({},J(d)),{goodRef:i,submitAdd:m,handleBeforeUpload:h,handleUrlSuccess:_,editor:e,handleChangeCate:v})}},Z={class:"add"},oo=N("\u4E0A\u67B6"),eo=N("\u4E0B\u67B6"),lo=["src"],ao={key:1,class:"el-icon-plus avatar-uploader-icon"},to={ref:"editor"};function ro(o,e,i,c,S,p){const d=u("el-cascader"),l=u("el-form-item"),m=u("el-input"),h=u("el-radio"),_=u("el-radio-group"),v=u("el-upload"),g=u("el-button"),a=u("el-form"),r=u("el-card");return F(),b("div",Z,[t(r,{class:"add-container"},{default:n(()=>[t(a,{model:o.goodForm,rules:o.rules,ref:"goodRef","label-width":"100px",class:"goodForm"},{default:n(()=>[t(l,{required:"",label:"\u5546\u54C1\u5206\u7C7B"},{default:n(()=>[t(d,{placeholder:o.defaultCate,style:{width:"300px"},props:o.category,onChange:c.handleChangeCate},null,8,["placeholder","props","onChange"])]),_:1}),t(l,{label:"\u5546\u54C1\u540D\u79F0",prop:"goodsName"},{default:n(()=>[t(m,{style:{width:"300px"},modelValue:o.goodForm.goodsName,"onUpdate:modelValue":e[0]||(e[0]=s=>o.goodForm.goodsName=s),placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(l,{label:"\u5546\u54C1\u7B80\u4ECB",prop:"goodsIntro"},{default:n(()=>[t(m,{style:{width:"300px"},type:"textarea",modelValue:o.goodForm.goodsIntro,"onUpdate:modelValue":e[1]||(e[1]=s=>o.goodForm.goodsIntro=s),placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u7B80\u4ECB(100\u5B57)"},null,8,["modelValue"])]),_:1}),t(l,{label:"\u5546\u54C1\u4EF7\u683C",prop:"originalPrice"},{default:n(()=>[t(m,{type:"number",min:"0",style:{width:"300px"},modelValue:o.goodForm.originalPrice,"onUpdate:modelValue":e[2]||(e[2]=s=>o.goodForm.originalPrice=s),placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u4EF7\u683C"},null,8,["modelValue"])]),_:1}),t(l,{label:"\u5546\u54C1\u552E\u5356\u4EF7",prop:"sellingPrice"},{default:n(()=>[t(m,{type:"number",min:"0",style:{width:"300px"},modelValue:o.goodForm.sellingPrice,"onUpdate:modelValue":e[3]||(e[3]=s=>o.goodForm.sellingPrice=s),placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u552E\u4EF7"},null,8,["modelValue"])]),_:1}),t(l,{label:"\u5546\u54C1\u5E93\u5B58",prop:"stockNum"},{default:n(()=>[t(m,{type:"number",min:"0",style:{width:"300px"},modelValue:o.goodForm.stockNum,"onUpdate:modelValue":e[4]||(e[4]=s=>o.goodForm.stockNum=s),placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u5E93\u5B58"},null,8,["modelValue"])]),_:1}),t(l,{label:"\u5546\u54C1\u6807\u7B7E",prop:"tag"},{default:n(()=>[t(m,{style:{width:"300px"},modelValue:o.goodForm.tag,"onUpdate:modelValue":e[5]||(e[5]=s=>o.goodForm.tag=s),placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u5C0F\u6807\u7B7E"},null,8,["modelValue"])]),_:1}),t(l,{label:"\u4E0A\u67B6\u72B6\u6001",prop:"goodsSellStatus"},{default:n(()=>[t(_,{modelValue:o.goodForm.goodsSellStatus,"onUpdate:modelValue":e[6]||(e[6]=s=>o.goodForm.goodsSellStatus=s)},{default:n(()=>[t(h,{label:"0"},{default:n(()=>[oo]),_:1}),t(h,{label:"1"},{default:n(()=>[eo]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(l,{required:"",label:"\u5546\u54C1\u4E3B\u56FE",prop:"goodsCoverImg"},{default:n(()=>[t(v,{class:"avatar-uploader",action:o.uploadImgServer,accept:"jpg,jpeg,png",headers:{token:o.token},"show-file-list":!1,"before-upload":c.handleBeforeUpload,"on-success":c.handleUrlSuccess},{default:n(()=>[o.goodForm.goodsCoverImg?(F(),b("img",{key:0,style:{width:"100px",height:"100px",border:"1px solid #e9e9e9"},src:o.goodForm.goodsCoverImg,class:"avatar"},null,8,lo)):(F(),b("i",ao))]),_:1},8,["action","headers","before-upload","on-success"])]),_:1}),t(l,{label:"\u8BE6\u60C5\u5185\u5BB9"},{default:n(()=>[K("div",to,null,512)]),_:1}),t(l,null,{default:n(()=>[t(g,{type:"primary",onClick:e[7]||(e[7]=s=>c.submitAdd())},{default:n(()=>[N(Q(o.id?"\u7ACB\u5373\u4FEE\u6539":"\u7ACB\u5373\u521B\u5EFA"),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})])}var mo=z(Y,[["render",ro],["__scopeId","data-v-5b264698"]]);export{mo as default};
