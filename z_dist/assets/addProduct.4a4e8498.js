var I=Object.defineProperty,q=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var C=(e,o,d)=>o in e?I(e,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[o]=d,w=(e,o)=>{for(var d in o||(o={}))R.call(o,d)&&C(e,d,o[d]);if(V)for(var d of V(o))N.call(o,d)&&C(e,d,o[d]);return e},U=(e,o)=>q(e,B(o));import{_ as z,u as A,c as P,b as $,h as j}from"./index.8857c13e.js";import{a2 as E,$ as k,a3 as M,u as D,r as G,b as _,o as L,a4 as O,t as T,d as c,e as v,f as b,j as l,w as u,_ as f,h as x,k as H,i as J}from"./vendor.bcf7419b.js";import"./wangEditor.71934d25.js";const K={name:"AddProduct",setup(){E();const e=k(null),o=k(null),d=M(),m=D(),{id:n}=d.query,a=G({uploadImgServer:A,uploadImgsServer:P,token:$("token")||"",id:n,defaultCate:"\u8BF7\u9009\u62E9\u5BA2\u6237",productForm:{name:"",spec:"",image:"",price:"",customer_id:""},rules:{customer_id:[{required:"true",message:"\u8BF7\u9009\u62E9\u5BA2\u6237",trigger:["change"]}],name:[{required:"true",message:"\u8BF7\u586B\u5199\u4EA7\u54C1\u540D\u79F0",trigger:["change"]}],spec:[{required:"true",message:"\u8BF7\u586B\u5199\u5C3A\u5BF8\u89C4\u683C",trigger:["change"]}],price:[{required:"true",message:"\u8BF7\u586B\u5199\u4EA7\u54C1\u4EF7\u683C",trigger:["change"]}]},customer_id:"",customer:{lazy:!0,lazyLoad(s,t){const{level:i=0}=s;_.get("/mgr/customers",{params:{action:"all_customer",pageNumber:1,pageSize:1e3}}).then(r=>{const S=r.list.map(y=>({value:y.id,label:y.name,leaf:i>=0}));t(S)})}}});L(()=>{n&&_.post("/mgr/products",{action:"get_product",id:n}).then(s=>{const{product:t}=s;a.productForm={id:n,name:t.name,spec:t.spec,image:t.image,price:t.price,customer_id:t.customer},a.customer_id=t.customer,a.defaultCate=`${t.customer}`,console.log(a.productForm)})}),O(()=>{});const h=()=>{o.value.validate(s=>{if(s){let t=_.post,i="add_product",r={customer_id:a.productForm.customer_id,name:a.productForm.name,spec:a.productForm.spec,price:a.productForm.price,image:a.productForm.image};if(j(r.name)||j(r.spec)){f.error("\u4E0D\u8981\u8F93\u5165\u8868\u60C5\u5305\uFF0C\u518D\u8F93\u5165\u5C31\u6253\u6B7B\u4F60\u4E2A\u9F9F\u5B59\u513F~");return}if(r.name.length>200){f.error("\u4EA7\u54C1\u540D\u79F0\u4E0D\u80FD\u8D85\u8FC7200\u4E2A\u5B57\u7B26");return}if(r.spec.length>200){f.error("\u5C3A\u5BF8\u89C4\u683C\u4E0D\u80FD\u8D85\u8FC7200\u4E2A\u5B57\u7B26");return}console.log("params",r),n&&(r.id=n,i="modify_product",t=_.put),t("/mgr/products",{action:i,data:r}).then(()=>{f.success(n?"\u4FEE\u6539\u6210\u529F":"\u6DFB\u52A0\u6210\u529F"),m.push({path:"/product"})})}})},p=s=>{const t=s.name.split(".")[1]||"";if(!["jpg","jpeg","png"].includes(t))return f.error("\u8BF7\u4E0A\u4F20 jpg\u3001jpeg\u3001png \u683C\u5F0F\u7684\u56FE\u7247"),!1},g=s=>{a.productForm.image=s.data.url||""},F=s=>{a.customer_id=s[0]||0,a.productForm.customer_id=s[0]||0};return U(w({},T(a)),{productRef:o,submitAdd:h,handleBeforeUpload:p,handleUrlSuccess:g,editor:e,handleChangeCate:F})}},Q={class:"add"},W=["src"],X={key:1,class:"el-icon-plus avatar-uploader-icon"};function Y(e,o,d,m,n,a){const h=c("el-cascader"),p=c("el-form-item"),g=c("el-input"),F=c("el-upload"),s=c("el-button"),t=c("el-form"),i=c("el-card");return v(),b("div",Q,[l(i,{class:"add-container"},{default:u(()=>[l(t,{model:e.productForm,rules:e.rules,ref:"productRef","label-width":"100px",class:"goodForm"},{default:u(()=>[l(p,{label:"\u5BA2\u6237",prop:"customer_id"},{default:u(()=>[l(h,{placeholder:e.defaultCate,width:"300px",props:e.customer,modelValue:e.productForm.customer_id,"onUpdate:modelValue":o[0]||(o[0]=r=>e.productForm.customer_id=r),onChange:m.handleChangeCate},null,8,["placeholder","props","modelValue","onChange"])]),_:1}),l(p,{label:"\u4EA7\u54C1\u540D\u79F0",prop:"name"},{default:u(()=>[l(g,{style:{width:"300px"},modelValue:e.productForm.name,"onUpdate:modelValue":o[1]||(o[1]=r=>e.productForm.name=r),placeholder:"\u8BF7\u8F93\u5165\u4EA7\u54C1\u540D\u79F0"},null,8,["modelValue"])]),_:1}),l(p,{label:"\u5C3A\u5BF8\u89C4\u683C",prop:"spec"},{default:u(()=>[l(g,{style:{width:"300px"},type:"textarea",modelValue:e.productForm.spec,"onUpdate:modelValue":o[2]||(o[2]=r=>e.productForm.spec=r),placeholder:"\u8BF7\u8F93\u5165\u5C3A\u5BF8\u89C4\u683C"},null,8,["modelValue"])]),_:1}),l(p,{label:"\u4EA7\u54C1\u4EF7\u683C",prop:"price"},{default:u(()=>[l(g,{type:"number",min:"0",style:{width:"300px"},modelValue:e.productForm.price,"onUpdate:modelValue":o[3]||(o[3]=r=>e.productForm.price=r),placeholder:"\u8BF7\u8F93\u5165\u4EA7\u54C1\u4EF7\u683C"},null,8,["modelValue"])]),_:1}),l(p,{label:"\u4EA7\u54C1\u4E3B\u56FE",prop:"image"},{default:u(()=>[x("v-if",!0),l(F,{class:"avatar-uploader",action:e.uploadImgServer,accept:"jpg,jpeg,png","show-file-list":!1,"before-upload":m.handleBeforeUpload,"on-success":m.handleUrlSuccess},{default:u(()=>[e.productForm.image?(v(),b("img",{key:0,style:{width:"100px",height:"100px",border:"1px solid #e9e9e9"},src:e.uploadImgsServer+e.productForm.image,class:"avatar"},null,8,W)):(v(),b("i",X))]),_:1},8,["action","before-upload","on-success"])]),_:1}),l(p,null,{default:u(()=>[l(s,{type:"primary",onClick:o[5]||(o[5]=r=>m.submitAdd())},{default:u(()=>[H(J(e.id?"\u7ACB\u5373\u4FEE\u6539":"\u7ACB\u5373\u521B\u5EFA"),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})])}var ae=z(K,[["render",Y],["__scopeId","data-v-4a5053a8"]]);export{ae as default};
